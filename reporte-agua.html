<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Reporte hídrico – Reserva Bosque Sereno</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background:#fdfaf5; margin:0; padding:1.5rem; color:#5c4033; }
    h1,h2 { color:#4c372b; }
    .card { background:#fff; border:1px solid #e6e2dc; border-radius:10px; padding:1rem; margin-bottom:2rem; }
    table { width:100%; border-collapse:collapse; font-size:.9rem; }
    th,td { padding:.5rem; border-bottom:1px solid #e6e2dc; text-align:left; }
    th { background:#f9f9f9; position:sticky; top:0; }
    .row-ex { background:#fff7f6; }
    .chips { display:flex; gap:.5rem; margin-top:.5rem; }
    .chip { padding:.25rem .5rem; border-radius:999px; font-size:.85rem; border:1px solid #e6e2dc; }
    .chip.ok { background:#d9ead3; }
    .chip.ex { background:#f9d5d3; }
    .canvas-wrap { padding:.5rem; border:1px solid #e6e2dc; border-radius:10px; background:#fff; }
    canvas { max-width:600px; max-height:400px; margin:auto; }
    .scroll-table { max-height:400px; overflow-y:auto; }
  </style>
</head>
<body>
  <h1>Reporte de consumo de agua</h1>
  <p><i>Lecturas de noviembre 2025 – Consumo pactado: 15 m³ por unidad</i></p>

  <div class="card">
    <h2>Resumen global</h2>
    <p>Total de unidades medidas: <b id="totalUnidades"></b></p>
    <p>Total pactado: <b id="totalPactado"></b> m³</p>
    <p>Excedente total: <b id="totalExcedente"></b> m³</p>
    <div class="chips">
      <span class="chip ok" id="chipEnRango"></span>
      <span class="chip ex" id="chipExcedente"></span>
    </div>
    <div class="canvas-wrap"><canvas id="pie"></canvas></div>
  </div>

  <div class="card">
    <h2>Excedente por vecino</h2>
    <div class="canvas-wrap"><canvas id="bars"></canvas></div>
  </div>

  <div class="card">
    <h2>Tabla por unidad</h2>
    <div class="scroll-table">
      <table>
        <thead>
          <tr><th>Nombre</th><th>Consumo</th><th>Pactados</th><th>Excedente</th></tr>
        </thead>
        <tbody id="tabla"></tbody>
      </table>
    </div>
  </div>

  <script>
    fetch('data.json')
      .then(res => res.json())
      .then(datos => {
        const totalUnidades = datos.personas.length;
        const totalPactado = totalUnidades * datos.pactados;
        const totalExcedente = datos.personas.reduce((s,p)=>s+(p.excedente||0),0);
        const conExcedente = datos.personas.filter(p=>p.excedente>0).length;
        const enRango = totalUnidades - conExcedente;

        document.getElementById("totalUnidades").textContent = totalUnidades;
        document.getElementById("totalPactado").textContent = totalPactado;
        document.getElementById("totalExcedente").textContent = totalExcedente;
        document.getElementById("chipEnRango").textContent = "En rango: "+enRango;
        document.getElementById("chipExcedente").textContent = "Con excedente: "+conExcedente;

        new Chart(document.getElementById('pie'), {
          type:'pie',
          data:{labels:['En rango','Con excedente'],datasets:[{data:[enRango,conExcedente],backgroundColor:['#d9ead3','#f9d5d3']}]},
          options:{plugins:{legend:{position:'bottom'}}}
        });

        const exSorted = datos.personas.filter(p=>p.excedente>0).sort((a,b)=>b.excedente-a.excedente);
        new Chart(document.getElementById('bars'), {
          type:'bar',
          data:{labels:exSorted.map(p=>p.nombre),datasets:[{label:'Excedente (m³)',data:exSorted.map(p=>p.excedente),backgroundColor:'#8b6f4e'}]},
          options:{indexAxis:'y',scales:{x:{beginAtZero:true}}}
        });

        const tbody = document.getElementById("tabla");
        datos.personas.forEach(p=>{
          const tr=document.createElement("tr");
          if(p.excedente>0) tr.classList.add("row-ex");
          tr.innerHTML=`<td>${p.nombre}</td><td>${p.consumo}</td><td>${datos.pactados}</td><td>${p.excedente}</td>`;
          tbody.appendChild(tr);
        });
      });
  </script>
</body>
</html>
