<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Resultados de la encuesta</title>
    <link rel="icon" href="img/favicon.png" type="image/png">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="styles/main.css">
    <meta name="description" content="Resultados y estad√≠sticas de la encuesta ‚Äî Reserva Bosque Sereno.">
    <meta property="og:title" content="Resultados de la encuesta">
    <meta property="og:description" content="Resultados y estad√≠sticas de la encuesta ‚Äî Reserva Bosque Sereno.">
    <meta property="og:image" content="https://fab9015.github.io/RBS/img/logo.png">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="600">
    <meta property="og:image:height" content="400">
    <meta property="og:url" content="https://fab9015.github.io/RBS/encuesta-aceptacion.html">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="es_MX">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Resultados de la encuesta">
    <meta name="twitter:description" content="Resultados y estad√≠sticas de la encuesta ‚Äî Reserva Bosque Sereno.">
    <meta name="twitter:image" content="https://fab9015.github.io/RBS/img/logo.png">
    <link rel="canonical" href="https://fab9015.github.io/RBS/encuesta-aceptacion.html">
    <style>
        .chart-box {
            background: white;
            padding: 20px;
            margin: 0 auto 40px auto;
            border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            max-width: 680px;
        }

        .chart-box h2 {
            text-align: center;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .emoji {
            text-align: center;
            font-size: 40px;
            margin-bottom: 10px;
        }

        .interpretacion {
            text-align: center;
            font-size: 15px;
            color: #555;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        canvas {
            width: 100%;
            max-height: 180px;
            margin-bottom: 10px;
        }

        .velocimetro canvas {
            max-height: 260px;
        }

        .conteo {
            font-size: 14px;
            margin-top: 10px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 8px;
        }

        .conteo span {
            display: inline-block;
            padding: 5px 8px;
            margin: 3px;
            border-radius: 5px;
            font-weight: bold;
            color: white;
        }

        .return-button {
            display: inline-block;
            background-color: #a1b27a;
            /* verde institucional */
            color: #fefefe;
            /* blanco */
            padding: 0.8em 1.2em;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 600;
            font-family: 'Lato', sans-serif;
            font-size: 1rem;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
            transition: background-color 0.2s ease, transform 0.2s ease;
        }

        .return-button:hover {
            background-color: #8fa76a;
            transform: translateY(-2px);
        }

        /* Layout: keep footer at bottom */
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        main#mainContent {
            flex: 1;
        }
    </style>
</head>

<body>

    <header>
        <div class="header-text">
            <h1>Resultados de la encuesta</h1>
            <p>Resultados y visualizaciones de la encuesta comunitaria</p>
        </div>
        <img src="img/logo.png" alt="Logo Reserva Bosque Sereno">
    </header>

    <!-- Menu fragment (injected) -->
    <div id="menuInclude"></div>

    <main id="mainContent">
        <div id="contenedorGraficas"></div>

        <div style="text-align: center; margin-top: 3em; margin-bottom: 4rem;">
            <a href="menu-accesos-rapidos.html" class="return-button">‚Üê Regresar</a>
        </div>
    </main>
    <script src="includes/embedded-data.js"></script>
    <script>
        const preguntas = [
            { clave: "p1", texto: "1. ¬øQu√© tan deacuerdo est√°s con la administraci√≥n de Agendum/Parametro?" },
            { clave: "p2", texto: "2. ¬øQu√© tan deacuerdo est√°s en cambiar la administraci√≥n actual?" },
            { clave: "p3", texto: "3. ¬øQu√© tan deacuerdo est√°s con aumentar la cuota si es necesario?" },
            { clave: "p4", texto: "4. ¬øSab√≠as que si la cuota no es adecuada, la cantidad y/o calidad de los servicios puede verse afectada?", binaria: true },
            { clave: "p5", texto: "5. ¬øQu√© tan disponible te consideras para participar en actividades del condominio?" }
        ];

        const expresiones = ["üò†", "üòï", "üòê", "üôÇ", "üòå", "ü´°"];

        const interpretaciones = [
            "Rechazo completo",
            "Rechazo parcial",
            "Inconformidad",
            "Postura neutral",
            "Aprobaci√≥n parcial",
            "Aprobaci√≥n total"
        ];

        const colores = [
            "#d32f2f", "#f57c00", "#fbc02d", "#cddc39", "#7cb342", "#388e3c"
        ];

        // centralized EMBEDDED_DATOS loaded above from includes/embedded-data.js

        (function loadDatos() {
            function processData(datos) {
                const contenedor = document.getElementById("contenedorGraficas");
                preguntas.forEach(pregunta => {
                    const div = document.createElement("div");
                    div.className = "chart-box";
                    const canvasId = `grafico_${pregunta.clave}`;

                    let valor, total = datos.length;
                    let conteo = {};

                    if (pregunta.binaria) {
                        const si = datos.filter(d => d.p4 === "S√≠").length;
                        const no = total - si;
                        valor = Math.round((si / total) * 100);
                    } else {
                        valor = Math.round(datos.reduce((sum, d) => sum + d[pregunta.clave], 0) / total);
                        for (let i = 0; i <= 5; i++) {
                            conteo[i] = datos.filter(d => d[pregunta.clave] === i).length;
                        }
                    }

                    const emoji = pregunta.binaria
                        ? (valor < 40 ? "üò†" : valor < 70 ? "üòê" : "ü´°")
                        : expresiones[valor];

                    const textoInterpretativo = pregunta.binaria
                        ? `Aprobaci√≥n del ${valor}% ‚Äî ${valor < 40 ? "Predomina el rechazo" : valor < 70 ? "Resultado neutral" : "Predomina la aprobaci√≥n"}`
                        : `Promedio de aprobaci√≥n: ${valor} ‚Äî ${interpretaciones[valor]}`;

                    div.innerHTML = `
                    <h2>${pregunta.texto}</h2>
                    <div class="emoji">${emoji}</div>
                    <canvas id="${canvasId}"></canvas>
                    <div class="interpretacion">${textoInterpretativo}</div>
                `;

                    const resumen = document.createElement("div");
                    resumen.className = "conteo";

                    if (pregunta.binaria) {
                        const si = datos.filter(d => d.p4 === "S√≠").length;
                        const no = total - si;
                        resumen.innerHTML = `
                        <strong>Total votos:</strong> ${total}<br>
                        <strong>‚ÄúS√≠‚Äù:</strong> ${si}<br>
                        <strong>‚ÄúNo‚Äù:</strong> ${no}
                    `;
                    } else {
                        resumen.innerHTML = `<strong>Total votos:</strong> ${total}<br><strong>Distribuci√≥n:</strong><br>`;
                        for (let i = 0; i <= 5; i++) {
                            const color = colores[i];
                            const texto = interpretaciones[i];
                            const cantidad = conteo[i] || 0;
                            resumen.innerHTML += `<span style="background:${color};color:white">${i} - ${texto}: ${cantidad}</span> `;
                        }
                    }

                    div.appendChild(resumen);
                    contenedor.appendChild(div);

                    const canvas = document.getElementById(canvasId);
                    const ctx = canvas.getContext("2d");
                    const grad = ctx.createLinearGradient(0, 0, canvas.width, 0);
                    grad.addColorStop(0.0, "#d32f2f");
                    grad.addColorStop(0.5, "#fbc02d");
                    grad.addColorStop(1.0, "#388e3c");

                    if (pregunta.binaria) {
                        const si = datos.filter(d => d.p4 === "S√≠").length;
                        const no = total - si;
                        new Chart(ctx, {
                            type: "doughnut",
                            data: {
                                labels: ["S√≠", "No"],
                                datasets: [{
                                    data: [si, no],
                                    backgroundColor: [grad, "#eee"],
                                    rotation: -90,
                                    circumference: 180
                                }]
                            },
                            options: {
                                cutout: "70%",
                                plugins: {
                                    legend: { display: false },
                                    tooltip: {
                                        callbacks: {
                                            label: ctx => `${ctx.label}: ${ctx.raw} votos`
                                        }
                                    }
                                }
                            }
                        });
                    } else {
                        new Chart(ctx, {
                            type: "bar",
                            data: {
                                labels: [pregunta.clave.toUpperCase()],
                                datasets: [{
                                    label: "Nivel de aprobaci√≥n",
                                    data: [valor],
                                    backgroundColor: grad
                                }]
                            },
                            options: {
                                indexAxis: 'y',
                                scales: {
                                    x: {
                                        min: 0,
                                        max: 5,
                                        ticks: {
                                            callback: val => expresiones[val] || val
                                        }
                                    },
                                    y: { ticks: { display: false } }
                                },
                                plugins: {
                                    legend: { display: false },
                                    tooltip: {
                                        callbacks: {
                                            label: ctx => `Nivel promedio: ${ctx.raw} (${interpretaciones[ctx.raw] || ''})`
                                        }
                                    }
                                }
                            }
                        });
                    }
                });

                // üßë‚Äçü§ù‚Äçüßë Compromiso comunitario
                const comprometidos = datos.filter(d => d.p2 >= 3 && d.p5 >= 3).length;
                const porcentaje = Math.round((comprometidos / datos.length) * 100);

                const resumenFinal = document.createElement("div");
                resumenFinal.className = "chart-box";
                resumenFinal.innerHTML = `
                <h2>Compromiso comunitario</h2>
                <div class="emoji">üßë‚Äçü§ù‚Äçüßë</div>
                <div class="interpretacion">
                    <strong>${comprometidos}</strong> vecinos respondieron con disposici√≥n al cambio y participaci√≥n<br>
                    Eso representa el <strong>${porcentaje}%</strong> del total encuestado
                </div>
            `;
                contenedor.appendChild(resumenFinal);
            }

            if (location.protocol === 'file:') {
                if (window.EMBEDDED_DATOS) {
                    processData(window.EMBEDDED_DATOS);
                } else {
                    console.warn('No embedded datos available for file:// preview');
                }
                return;
            }

            fetch('datos.json')
                .then(response => response.json())
                .then(processData)
                .catch(err => {
                    console.warn('Fetch failed, falling back to embedded datos', err);
                    if (window.EMBEDDED_DATOS) processData(window.EMBEDDED_DATOS);
                });
        })();
    </script>
    <div id="footerInclude"></div>
    <script src="includes/load-fragments.js"></script>
</body>

</html>