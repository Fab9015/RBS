<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Dashboard de Directorio</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        body {
            font-family: 'Lato', sans-serif;
            background: #fdfaf5;
            color: #5c4033;
            margin: 0;
        }

        header {
            background: #a1b27a;
            color: #fff;
            padding: 1em;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        header h1 {
            margin: 0;
        }

        header .header-buttons {
            display: flex;
            gap: 10px;
        }

        header button {
            background: #fff;
            color: #5c4033;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
        }

        header button:hover {
            background: #eee;
        }

        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1em;
            flex-wrap: wrap;
        }

        .toolbar input,
        .toolbar select {
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 6px;
            margin-right: 8px;
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            padding: 1em;
        }

        .card {
            background: #fff;
            border: 2px solid #a1b27a;
            border-radius: 8px;
            width: 280px;
            margin: 1em;
            padding: 1em;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: relative;
            min-height: 380px;
            /* altura fija m√°s grande */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .card img {
            width: 100%;
            height: 150px;
            object-fit: contain;
        }

        .card h3 {
            margin: 0.5em 0;
        }

        .card p.relevante-label {
            min-height: 20px;
            /* espacio reservado aunque no haya texto */
        }

        .card .actions {
            display: flex;
            justify-content: space-between;
            margin-top: auto;
        }

        .card button {
            flex: 1;
            margin: 0 4px;
            padding: 6px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .edit-btn {
            background: #8fa76a;
            color: #fff;
        }

        .delete-btn {
            background: #d9534f;
            color: #fff;
        }

        .edit-btn:hover {
            background: #7a935d;
        }

        .delete-btn:hover {
            background: #c9302c;
        }

        .category-tag {
            display: inline-block;
            background: #a1b27a;
            color: #fff;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8em;
            position: absolute;
            top: 8px;
            right: 8px;
        }

        /* Sidebar */
        .sidebar {
            padding: 1em;
            border-top: 2px solid #a1b27a;
            background: #fff;
        }

        .sidebar h2 {
            margin-top: 0;
        }

        .sidebar .cat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 4px 0;
            padding: 4px;
            border-bottom: 1px solid #eee;
        }

        .sidebar .cat-row button {
            margin-left: 4px;
            padding: 4px 6px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
        }

        .sidebar .edit-cat {
            background: #8fa76a;
            color: #fff;
        }

        .sidebar .delete-cat {
            background: #d9534f;
            color: #fff;
        }

        .sidebar .add-cat-btn {
            background: #fff;
            color: #5c4033;
            border: none;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            float: right;
            margin-bottom: 8px;
        }

        .sidebar .add-cat-btn:hover {
            background: #eee;
        }

        /* Paginaci√≥n */
        #paginacion {
            text-align: center;
            margin: 1em;
        }

        #paginacion button {
            margin: 0 2px;
            padding: 6px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        #paginacion span {
            margin: 0 4px;
        }

        /* JSON output */
        .json-section {
            padding: 1em;
            background: #fff;
            border-top: 2px solid #a1b27a;
        }

        .json-section textarea {
            width: 100%;
            height: 250px;
            font-family: monospace;
            margin-top: 1em;
        }

        .json-section button {
            background: #fff;
            color: #5c4033;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 6px;
        }

        .json-section button:hover {
            background: #eee;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: #fff;
            padding: 1.5em;
            border-radius: 8px;
            width: 400px;
            max-width: 90%;
        }

        .modal-content label {
            display: block;
            margin-top: 0.5em;
        }

        .modal-content input,
        .modal-content select {
            width: 100%;
            padding: 6px;
            margin-top: 4px;
            border: 1px solid #ccc;
            border-radius: 6px;
        }

        .modal-content .relevante {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            margin-top: 0.5em;
        }

        .modal-content .relevante input {
            margin-right: 6px;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 1em;
        }

        .modal-actions button {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .modal-actions .save-btn {
            background: #a1b27a;
            color: #fff;
        }

        .modal-actions .cancel-btn {
            background: #ccc;
            color: #333;
        }

        /* Responsive */
        @media(max-width:600px) {
            .card {
                width: 100%;
            }

            .toolbar {
                flex-direction: column;
                gap: 0.5em;
            }
        }
    </style>
</head>

<body>
    <header>
        <h1>Dashboard de Directorio</h1>
        <div class="header-buttons">
            <button onclick="openModal()">+ Crear trabajador</button>
            <button onclick="downloadJSON()">Descargar archivo</button>
            <button onclick="copiarJSON()">Copiar datos</button>
        </div>
    </header>
    <!-- Herramientas -->
    <div class="toolbar">
        <div>
            <input id="search-input" placeholder="Buscar por nombre..." oninput="renderCards()">
            <select id="orden-select" onchange="ordenarTrabajadores(this.value)">
                <option value="az">Ordenar A-Z</option>
                <option value="za">Ordenar Z-A</option>
            </select>
        </div>
        <label>
            Mostrar:
            <select onchange="porPagina=parseInt(this.value);paginaActual=1;renderCards()">
                <option value="6">6</option>
                <option value="12">12</option>
                <option value="24">24</option>
            </select>
        </label>
    </div>

    <!-- Cards -->
    <div class="container" id="cards-container"></div>

    <!-- Paginaci√≥n -->
    <div id="paginacion"></div>

    <!-- Sidebar -->
    <div class="sidebar">
        <h2>Categor√≠as
            <button class="add-cat-btn" onclick="addCategoria()">+ Agregar categor√≠a</button>
        </h2>
        <div id="categorias-list"></div>

        <h2>B√∫squedas relevantes</h2>
        <div id="busquedas-list"></div>
    </div>

    <!-- JSON generado -->
    <div class="json-section">
        <h2>JSON generado</h2>
        <textarea id="output" readonly></textarea>
    </div>
    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <h2 id="modal-title">Agregar trabajador</h2>
            <label>Nombre: <input id="nombre"></label>
            <label>Tel√©fono: <input id="telefono"></label>
            <label>Correo: <input id="correo"></label>
            <label>Categor√≠a:
                <select id="categoria"></select>
            </label>
            <div class="relevante">
                <input type="checkbox" id="relevante">
                <label for="relevante">Contacto relevante</label>
            </div>
            <div class="modal-actions">
                <button class="save-btn" onclick="saveTrabajador()">Guardar</button>
                <button class="cancel-btn" onclick="closeModal()">Cancelar</button>
            </div>
        </div>
    </div>
    <!-- Scripts -->
    <script>
        let data = {};
        let paginaActual = 1;
        let porPagina = 6;
        let editId = null;
        let orden = "az";

        /* Generador de UUID v4 */
        function generarUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        /* Cargar JSON */
        fetch('directorio.json')
            .then(r => r.json())
            .then(json => {
                data = json;

                // Asignar UUID si no existe
                data.trabajadores = data.trabajadores.map(t => ({
                    id: t.id || generarUUID(),
                    ...t
                }));

                renderCards();
                renderBusquedas();
                renderCategoriasList();
                fillCategories();
                updateOutput();
            });

        /* Modal CRUD trabajadores */
        function openModal(id = null) {
            document.getElementById("modal").style.display = "flex";
            document.getElementById("modal-title").textContent = id === null ? "Agregar trabajador" : "Editar trabajador";
            editId = id;
            fillCategories();
            if (id !== null) {
                const t = data.trabajadores.find(x => x.id == id);
                document.getElementById("nombre").value = t.nombre;
                document.getElementById("telefono").value = t.telefono;
                document.getElementById("correo").value = t.correo;
                document.getElementById("categoria").value = t.categoria;
                document.getElementById("relevante").checked = t.relevante || false;
            } else {
                document.getElementById("nombre").value = "";
                document.getElementById("telefono").value = "";
                document.getElementById("correo").value = "";
                document.getElementById("categoria").value = data.categorias[0];
                document.getElementById("relevante").checked = false;
            }
        }

        function saveTrabajador() {
            const nombre = document.getElementById("nombre").value.trim();
            const telefono = document.getElementById("telefono").value.trim();
            const correo = document.getElementById("correo").value.trim();
            const categoria = document.getElementById("categoria").value;
            const relevante = document.getElementById("relevante").checked;

            if (!nombre || !telefono) { alert("Nombre y tel√©fono son obligatorios"); return; }

            const imagenesDisponibles = {
                "Plomero": "img/plomero.png", "Electricista": "img/electricista.png", "Carpintero": "img/carpintero.png",
                "Servicios de limpieza": "img/limpieza.png", "Jardinero": "img/jardinero.png", "Alba√±il": "img/trabajador.png",
                "Administrador": "img/admin.png", "Vigilancia": "img/vigilancia.png"
            };
            const imagen = imagenesDisponibles[categoria] || "img/trabajador.png";

            const nuevo = {
                id: editId || generarUUID(), // üîë UUID aqu√≠
                nombre, telefono, correo, categoria, imagen, relevante
            };

            if (editId === null) {
                data.trabajadores.push(nuevo);
            } else {
                const idx = data.trabajadores.findIndex(x => x.id == editId);
                if (idx > -1) { data.trabajadores[idx] = nuevo; }
            }

            closeModal();
            renderCards();
        }

        function deleteTrabajador(id) {
            if (confirm("¬øEliminar este trabajador?")) {
                const idx = data.trabajadores.findIndex(x => x.id == id);
                if (idx > -1) {
                    data.trabajadores.splice(idx, 1);
                    renderCards();
                }
            }
        }

        function closeModal() {
            document.getElementById("modal").style.display = "none";
            editId = null;
        }

        function fillCategories() {
            const sel = document.getElementById("categoria");
            sel.innerHTML = "";
            data.categorias.forEach(cat => {
                const opt = document.createElement("option");
                opt.value = cat;
                opt.textContent = cat;
                sel.appendChild(opt);
            });
        }

        /* Exportar y copiar JSON */
        function updateOutput() {
            const out = document.getElementById("output");
            if (out) {
                out.value = JSON.stringify(data, null, 2);
            }
        }

        function downloadJSON() {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "directorio.json";
            a.click();
            URL.revokeObjectURL(url);
        }

        function copiarJSON() {
            const out = document.getElementById("output");
            out.select();
            document.execCommand("copy");
            alert("Datos copiados al portapapeles");
        }
    </script>
</body>

</html>
