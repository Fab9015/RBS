<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logros – Reserva Bosque Sereno</title>
    <link rel="icon" href="img/favicon.png" type="image/png">
    <link rel="stylesheet" href="styles/main.css">

    <meta name="description" content="Logros y avances del condominio Reserva Bosque Sereno.">
    <meta name="keywords" content="Reserva Bosque Sereno, logros, avances, condominio">
    <meta name="author" content="Reserva Bosque Sereno">

    <!-- Open Graph -->
    <meta property="og:title" content="Logros – Reserva Bosque Sereno">
    <meta property="og:description" content="Logros y avances del condominio Reserva Bosque Sereno.">
    <meta property="og:image" content="https://fab9015.github.io/RBS/img/logo.png">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://fab9015.github.io/RBS/logors.html">
    <meta property="og:locale" content="es_MX">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Logros – Reserva Bosque Sereno">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&family=Lato:wght@400;700&display=swap"
        rel="stylesheet">

    <style>
        /* Page-scoped styles for an elegant, responsive achievements page */
        :root {
            --hero-bg-1: #f3f6f1;
            --hero-bg-2: #e6efe0;
            --accent: #8fa76a;
            --muted: #6b6b6b;
            --card-bg: #ffffff;
            --glass: rgba(255, 255, 255, 0.6);
            --progress-color: #d97706;
            --cta: var(--progress-color);
            --cta-dark: #b65a1f;
            /* default: orange (user choice) */
        }

        main {
            padding: 2.5rem 1rem 4rem;
        }

        .hero {
            background: linear-gradient(120deg, var(--hero-bg-1), var(--hero-bg-2));
            border-radius: 14px;
            padding: 2.2rem 1.2rem;
            max-width: 1200px;
            margin: 0 auto 1.6rem;
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 1rem;
            align-items: center;
            box-shadow: 0 6px 18px rgba(40, 40, 40, 0.06);
        }

        .hero h1 {
            margin: 0;
            font-size: 2.2rem;
            letter-spacing: -0.02em;
        }

        .hero p {

            margin: 0.4rem 0 0;
            color: var(--muted);
        }

        .hero .logo {
            width: 84px;
            height: 84px;
            border-radius: 12px;
            object-fit: contain;
        }

        .controls {
            max-width: 1200px;
            margin: 1rem auto 0;
            display: flex;
            justify-content: flex-end;
        }

        /* Desktop: place filters inline and keep the clear button to the right */
        .controls-inner {
            width: auto;
            max-width: 900px;
            margin-left: auto;
            /* push controls to the right */
            display: flex;
            justify-content: flex-end;
            gap: .6rem;
            padding: 0 1rem;
            align-items: center;
        }

        /* CTA styles (follows --progress-color) */

        .controls-inner .filters-row {
            display: flex;
            gap: 0.6rem;
            align-items: center;
        }

        /* back body: top spacing to clear the media, plus lateral margins */
        .flip-back .card-body {
            margin: 48px 0 1.05rem;
            /* top, left/right, bottom */
            padding-top: 0;
        }

        .btn {
            background: var(--accent);
            color: #fff;
            padding: 0.55rem 0.9rem;
            border-radius: 8px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(143, 167, 106, 0.18);
        }

        /* 'Leer más' CTA: distinct from category tag colors but harmonizes with palette */
        .btn-open-details {
            background: var(--cta);
            color: #fff;
            padding: .45rem .75rem;
            border-radius: 8px;
            font-weight: 700;
            border: none;
            cursor: pointer;
            box-shadow: 0 6px 16px rgba(59, 130, 246, 0.12);
            transition: background .12s ease, transform .06s ease;
        }

        .btn-open-details:hover {
            background: var(--cta-dark);
            transform: translateY(-1px);
        }

        .grid {
            max-width: 1200px;
            margin: 1.2rem auto 0;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.1rem;
            padding: 0 1rem;
        }

        .card {
            position: relative;
            overflow: hidden;
            background: var(--card-bg);
            border-radius: 12px;
            padding: 0;
            /* increased so 4 text lines fit without clipping progress/tags */
            min-height: 380px;
            /* increased so card content doesn't appear cut off */
            box-shadow: 0 6px 18px rgba(30, 30, 30, 0.04);
            transition: transform .18s ease, box-shadow .18s ease;
        }

        .card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 30px rgba(30, 30, 30, 0.08);
        }

        .card .title {
            font-weight: 700;
            color: #233;
            margin: 0;
            font-size: 1.05rem;
        }

        .card .desc {
            color: var(--muted);
            font-size: 0.95rem;
            margin: 0;
        }

        /* Control vertical spacing between the title and its following block on the front face */
        .card .card-body>div {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            /* increased spacing as requested (option 1) */
        }

        .tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: auto;
        }

        .tag {
            background: var(--glass);
            padding: 0.25rem 0.5rem;
            border-radius: 999px;
            font-size: 0.82rem;
            color: var(--muted);
            border: 1px solid rgba(0, 0, 0, 0.03);
        }

        /* Responsive */
        @media (max-width: 992px) {
            .grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .hero {
                grid-template-columns: 1fr auto;
            }
        }

        @media (max-width: 640px) {
            .grid {
                grid-template-columns: 1fr;
            }

            .card {
                /* make slightly taller on small screens to avoid clipping */
                min-height: 260px;
            }

            .hero {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .controls {
                justify-content: center;
            }

            .hero .logo {
                margin: 0 auto;
            }
        }

        /* Small helpers */
        .kicker {
            color: var(--accent);
            font-weight: 700;
            letter-spacing: 0.02em;
        }

        .filter-label {
            display: flex;
            align-items: center;
            gap: .4rem;
            color: var(--muted);
            font-size: 0.95rem;
        }

        .filter-label select {
            padding: .35rem .5rem;
            border-radius: 6px;
            border: 1px solid rgba(0, 0, 0, 0.08);
            background: #fff;
            font-size: .95rem;
        }

        /* Palette chooser removed (testing only) */

        /* Card media, progress and accordion details */
        .media {
            height: 48px;
            min-height: 48px;
            max-height: 48px;
            border-radius: 12px 12px 0 0;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            box-shadow: inset 0 -8px 20px rgba(0, 0, 0, 0.04);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: 700;
            text-align: center;
            padding: 0.5rem;
            width: 100%;
            margin: 0;
            box-sizing: border-box;
            overflow: hidden;
        }

        .media .cat-label {
            font-size: 0.95rem;
            line-height: 1.1;
            white-space: nowrap;
            text-overflow: ellipsis;
            overflow: hidden;
        }

        .progress {
            height: 8px;
            background: #f1f3f1;
            border-radius: 999px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            /* use a solid tone so 100% visibly reaches the end */
            background: linear-gradient(90deg, var(--progress-color), var(--progress-color));
            border-radius: 999px;
            transition: width .45s ease;
        }

        /* ghost button to avoid color collision with category chips */
        .btn-ghost {
            background: transparent;
            border: 1px solid rgba(0, 0, 0, 0.08);
            color: var(--muted);
            padding: .45rem .7rem;
            border-radius: 6px;
            font-size: .95rem;
            cursor: pointer;
        }

        .btn-ghost:hover {
            background: rgba(0, 0, 0, 0.02);
        }

        /* details/accordion removed (not used) */

        /* Flip card styles */
        .flip-card {
            perspective: 1200px;
        }


        /* make the flip surface fill the entire card (no inset) */
        .flip-inner {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform .6s cubic-bezier(.2, .9, .2, 1);
            z-index: 1;
        }

        .flip-inner .flip-face {
            backface-visibility: hidden;
            position: absolute;
            inset: 0;
            border-radius: inherit;
            display: flex;
            flex-direction: column;
            gap: .5rem;
            padding: 0;
            box-sizing: border-box;
            overflow: hidden;
        }

        .card-body {
            padding: 1.05rem;
            display: flex;
            flex-direction: column;
            gap: .5rem;
            box-sizing: border-box;
        }

        /* Left-align descriptive text inside cards (modal will be justified separately) */
        .card .card-body p,
        .card .desc,
        .flip-back .card-body p {
            text-align: left;
        }

        /* Justify modal body text for easier long-form reading */
        .detail-dialog .modal-body {
            text-align: justify;
        }

        /* Ensure front-face footer (progress + tags) stays pinned to card bottom */
        .flip-face .card-body {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .flip-front .card-body {
            /* allow the body to grow to fill the face so .card-foot can push to bottom */
            flex: 1 1 auto;
        }

        .card-foot {
            margin-top: auto;
            display: flex;
            flex-direction: column;
            gap: .5rem;
        }



        .flip-front {
            transform: rotateY(0);
        }

        .flip-back {
            transform: rotateY(180deg);
            background: var(--card-bg);
            color: var(--muted);
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }

        /* use margin on the back card-body to align with the front media */
        .flip-back .card-body {
            margin-top: 48px;
            /* reserve same height as .media */
            padding-top: 0;
            gap: 1.2rem;
            /* spacing between heading and following block on the back face (matched to front) */
        }

        /* Ensure paragraphs inside the back face have no extra default margins */
        .flip-back .card-body p {
            margin: 0;
        }

        .flipped .flip-inner {
            transform: rotateY(180deg);
        }

        /* Mobile pager styles */
        .mobile-pager {
            display: flex;
            gap: .6rem;
            justify-content: center;
            padding: .9rem 0 1.2rem;
            align-items: center;
        }

        .m-btn {
            width: 36px;
            height: 36px;
            border-radius: 999px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border: none;
            background: var(--accent);
            color: #fff;
            box-shadow: 0 6px 18px rgba(20, 20, 20, 0.08);
            cursor: pointer;
            height: 44px;
            min-height: 44px;
            max-height: 44px;
            background: #fff;
            color: var(--accent);
            border: 1px solid rgba(0, 0, 0, 0.06);
        }

        /* hide pager and sticky controls on desktop */
        @media (min-width: 641px) {

            .mobile-pager,
            .mobile-sticky-controls {
                display: none !important;
            }
        }

        /* sticky controls on mobile (right-bottom) */
        .mobile-sticky-controls {
            position: fixed;
            right: 6px;
            left: auto;
            bottom: 72px;
            display: flex;
            flex-direction: column;
            gap: .6rem;
            z-index: 80;
            /* reduced so menu overlay can sit above these buttons (overlay z-index is 900 in main.css) */
            align-items: center;
            pointer-events: auto;
            margin: 44px 25px 1.05rem;
            transition: transform .18s ease, opacity .18s ease;
            transform: translateX(25px);
        }

        /* Sticky buttons: vertical pills (preserve height, reduce width) */
        .mobile-sticky-controls .m-btn {
            margin-top: 0;
            color: var(--accent);
            border: 1px solid var(--accent);
            box-shadow: 0 6px 10px rgba(20, 20, 20, 0.06);
            /* keep a taller, circular-cap height */
            height: 44px;
            min-height: 44px;
            /* reduce width explicitly instead of scaling (prevents icon distortion) */
            width: 36px;
            min-width: 36px;
            padding: 0;
            border-radius: 22px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: #fff;
            transition: box-shadow .12s ease, background .12s ease;
        }

        .mobile-sticky-controls .m-btn svg,
        .mobile-pager .m-btn svg {
            width: 16px;
            height: 16px;
            stroke: currentColor;
        }

        /* Mobile pager: filled accent button with white icon */
        .mobile-pager .m-btn {
            background: var(--accent);
            color: #ffffff;
            border: none;
            box-shadow: 0 6px 16px rgba(20, 20, 20, 0.12);
            width: 44px;
            height: 44px;
            min-width: 44px;
            min-height: 44px;
            padding: 0;
            border-radius: 999px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .mobile-pager .m-btn svg {
            stroke: #ffffff;
            fill: none;
            width: 18px;
            height: 18px;
        }

        /* Modal for full details (responsive) */
        .detail-modal {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.45);
            z-index: 11050;
            padding: 1rem;
            overflow-x: hidden;
        }

        .detail-modal.active {
            display: flex;
        }

        .detail-dialog {
            background: var(--card-bg);
            /* use flex-column so footer can be anchored to the dialog bottom */
            display: flex;
            flex-direction: column;
            width: auto;
            max-width: 1040px;
            /* let the dialog grow to its content, but never exceed the viewport height */
            height: auto;
            max-height: calc(100vh - 48px);
            /* keep the rounded corners visible by hiding overflow on the container
               and delegating scrolling to the inner .modal-body */
            overflow: hidden;
            border-radius: 14px;
            box-shadow: 0 20px 50px rgba(20, 20, 20, 0.2);
            /* unified inner padding applied to the dialog so title and body align */
            padding: 1.25rem;
            box-sizing: border-box;
            position: relative;
            min-width: 0;
            margin: 0 auto;
        }

        /* stronger selector to prevent stretching inside the overlay */
        .detail-modal .detail-dialog {
            align-self: center;
            display: flex !important;
            flex-direction: column !important;
            width: auto;
            /* never exceed the viewport width minus some gutter */
            /* use a single, explicit max-width expression */
            height: auto;
            min-height: 0;
            /* enforce corner rounding and prevent outer overflow from negating radius */
            border-radius: 16px !important;
            overflow: hidden !important;
        }

        .detail-dialog .modal-title {
            margin: .6rem 0 1rem 0;
            /* add extra top margin so the title sits clearly below the close button */
            padding-top: 0;
            font-size: 1.15rem;
            text-align: center;
        }

        .detail-dialog .modal-body {
            color: var(--muted);
            line-height: 1.45;
            overflow: auto;
            max-height: calc(100vh - 160px);
            /* allow the body to take available space so footer stays at bottom */
            flex: 1 1 auto;
        }

        /* top-close removed by request */

        .detail-dialog .modal-footer {
            margin-top: 1rem;
            display: flex;
            justify-content: center;
            gap: .6rem;
        }

        .detail-dialog .modal-close-footer {
            background: var(--cta);
            color: #fff;
            border: none;
            padding: .6rem .9rem;
            border-radius: 8px;
            cursor: pointer;
        }

        /* mobile: full-screen dialog */
        @media (max-width: 640px) {
            .detail-dialog {
                display: block;
                width: 100%;
                height: 100%;
                max-width: none;
                max-height: none;
                border-radius: 0;
                padding: 1.5rem;
            }

            /* top-close removed */
        }

        /* removed focus outline — we use smooth scroll to top instead of focusing the heading */

        /* modal styles removed (not used) */

        /* Responsive filters: stack controls on narrow viewports */
        @media (max-width: 640px) {
            .controls-inner {
                flex-direction: column !important;
                align-items: stretch;
                gap: .5rem;
                padding: 0 1rem;
            }

            .controls-inner .filters-row {
                display: flex;
                gap: .5rem;
                width: 100%;
            }

            .controls-inner .filters-row .filter-label {
                width: 50%;
                display: flex;
                flex-direction: column;
            }

            .controls-inner .filters-row .filter-label select {
                width: 100%;
            }

            /* place clear button below selects and align to right */
            #btn-clear {
                width: auto;
                align-self: flex-end;
                margin-top: .5rem;
            }

            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <header>
        <div>
            <h1 class="page-title">Logros y Avances</h1>

            <p class="subtitle">Resumen de acciones y mejoras realizadas en Reserva Bosque Sereno</p>
        </div>
        <img src="img/logo.png" alt="Logo Reserva Bosque Sereno">
    </header>

    <!-- Menu fragment (injected) -->
    <div id="menuInclude"></div>

    <main>
        <div class="hero">
            <div>
                <div class="kicker">Resultados & Avances</div>
                <h1>Logros recientes</h1>
                <p class="subtitle">Compromisos cumplidos y proyectos en marcha para mejorar la convivencia y los
                    servicios del condominio.</p>
            </div>
        </div>

        <div class="controls">
            <div class="controls-inner">
                <div class="filters-row">
                    <label class="filter-label">Categoría
                        <select id="filterCategory">
                            <option value="">Todas</option>
                        </select>
                    </label>

                    <label class="filter-label">Estatus
                        <select id="filterStatus">
                            <option value="">Todos</option>
                        </select>
                    </label>
                </div>
                <button class="btn-ghost" id="btn-clear" aria-label="Limpiar filtros">Limpiar</button>
            </div>
        </div>

        <section id="gallery" class="section-view active" style="display:block;">
            <div class="grid" id="galleryGrid"></div>
        </section>
    </main>
    <script>
        // Data and palette (palette will be built from payload.categories at runtime)
        let achievements = [];
        let _palette = {};
        let categoriesList = [];

        /* progress swatches removed — not used in production */

        // Filters
        let currentCategory = '';
        let currentStatus = '';
        // Mobile pagination parameters (configurable)
        let mobileInitial = 5; // number of cards shown by default on mobile
        let mobileBatch = 5; // number of cards to reveal on each "show more"
        let mobileVisibleCount = mobileInitial; // runtime state

        // Render gallery as flip-cards (click/tap to flip). The colored category header sits above the flip faces.
        function renderGallery() {
            const g = document.getElementById('galleryGrid'); g.innerHTML = '';
            const filtered = achievements.filter(a => {
                if (currentCategory && a.category !== currentCategory) return false;
                if (currentStatus && a.status !== currentStatus) return false;
                return true;
            });
            const isMobile = window.matchMedia('(max-width:640px)').matches;
            const total = filtered.length;
            // On desktop always show all items; mobile uses the paged slice.
            if (!isMobile) mobileVisibleCount = total;
            // when on mobile, render only the currently visible slice
            const toRender = isMobile ? filtered.slice(0, mobileVisibleCount) : filtered;
            // ensure mobileVisibleCount is within bounds when on mobile
            if (isMobile) mobileVisibleCount = Math.max(mobileInitial, Math.min(mobileVisibleCount, total));
            toRender.forEach((a) => {
                const card = document.createElement('article');
                card.className = 'card flip-card';
                card.setAttribute('tabindex', '0');
                card.innerHTML = `
                        <div class="flip-inner">
                            <div class="flip-face flip-front">
                                <div class="media card-media"><div class="cat-label">${a.category}</div></div>
                                <div class="card-body">
                                    <div>
                                        <h3 class="title">${a.title}</h3>
                                        <p class="desc">${a.frontSummary || a.fullSummary}</p>
                                    </div>
                                    <div class="card-foot">
                                        <div class="progress" aria-hidden="true"><div class="progress-bar" style="width:${a.progress}%"></div></div>
                                        <div class="tags"><span class="tag">${a.category}</span><span class="tag" style="margin-left:auto">${a.status}</span></div>
                                    </div>
                                </div>
                            </div>
                            <div class="flip-face flip-back">
                                <div class="card-body">
                                    <h3 class="title">${a.title}</h3>
                                    <div style="color:var(--muted); font-size:.96rem">
                                        <p>${a.backSummary || a.fullSummary}</p>
                                    </div>
                                    <div class="card-foot"><button class="btn btn-open-details" data-idx="${achievements.indexOf(a)}">Leer más</button></div>
                                </div>
                            </div>
                        </div>
                    `;
                g.appendChild(card);
                // attach direct handler to the 'Leer más' button to avoid relying on index lookups
                const detailBtn = card.querySelector('.btn-open-details');
                if (detailBtn) {
                    detailBtn.onclick = (e) => { openDetailsModalItem(a); };
                }
                // style media as colored block with category label (part of front face so whole card flips)
                const mediaEl = card.querySelector('.card-media');
                const pal = _palette[a.category] || ['#d4e6d0', '#233'];
                mediaEl.style.backgroundColor = pal[0];
                mediaEl.style.color = pal[1];
                mediaEl.innerHTML = `<div class="cat-label">${a.category}</div>`;
            });
            // update mobile pager (create if needed)
            updateMobilePager(total);
            // ensure sticky handlers exist (buttons are static in DOM)
            attachMobileStickyHandlers();
            // attach detail modal handlers for any new buttons
            attachDetailHandlers();
        }

        // Open modal using an achievement object — always prefer `fullSummary` for modal content
        function openDetailsModalItem(item) {
            const modal = document.getElementById('detailModal');
            const titleEl = document.getElementById('detailModalTitle');
            const bodyEl = document.getElementById('detailModalBody');
            if (!modal || !item) return;
            titleEl.textContent = item.title || '';
            // force use of fullSummary in modal
            bodyEl.innerHTML = (item.fullSummary || '');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Attach flip handlers: click/tap or Enter/Space to flip. Only one flipped at a time.
        function attachFlipHandlers() {
            const cards = document.querySelectorAll('.card.flip-card');
            cards.forEach(card => {
                // click/tap
                card.addEventListener('click', (e) => {
                    const target = e.target;
                    if (target && (target.closest('a') || target.closest('button'))) return;
                    const already = card.classList.contains('flipped');
                    document.querySelectorAll('.card.flipped').forEach(c => { if (c !== card) c.classList.remove('flipped'); });
                    if (already) card.classList.remove('flipped'); else card.classList.add('flipped');
                });
                // keyboard
                card.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault(); card.click();
                    }
                });
            });
        }

        // Mobile pager controls
        function makeIcon(svg) { return svg; }

        function updateMobilePager(total) {
            const isMobile = window.matchMedia('(max-width:640px)').matches;
            let pager = document.getElementById('mobilePager');
            if (!isMobile) {
                if (pager) pager.remove();
                return;
            }
            if (!pager) {
                pager = document.createElement('div');
                pager.id = 'mobilePager';
                pager.className = 'mobile-pager';
                const grid = document.getElementById('galleryGrid');
                grid.parentNode.insertBefore(pager, grid.nextSibling);
            }

            pager.innerHTML = '';
            // determine state
            const atEnd = mobileVisibleCount >= total;

            // If we've reached the end, hide the pager entirely (sticky controls remain available)
            if (atEnd) {
                pager.style.display = 'none';
                return;
            }

            // main button (only shown when not at end)
            const main = document.createElement('button');
            main.className = 'm-btn';
            main.title = 'Mostrar más';
            main.innerHTML = makeIcon('<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>');
            main.onclick = () => {
                mobileVisibleCount = Math.min(total, mobileVisibleCount + mobileBatch);
                renderGallery(); attachFlipHandlers();
            };
            pager.appendChild(main);

            // (Removed pager extra buttons: sticky controls handle show all/default now)

            // hide pager if no items or total <= mobileInitial
            if (total <= mobileInitial) pager.style.display = 'none';
            else pager.style.display = 'flex';
        }

        // helper: compute filtered total respecting current filters
        function getFilteredTotal() {
            return achievements.filter(a => {
                if (currentCategory && a.category !== currentCategory) return false;
                if (currentStatus && a.status !== currentStatus) return false;
                return true;
            }).length;
        }

        // attach handlers to persistent sticky mobile buttons
        function attachMobileStickyHandlers() {
            const btnAll = document.getElementById('mobileShowAll');
            const btnDefault = document.getElementById('mobileShowDefault');
            if (!btnAll || !btnDefault) return;
            btnAll.onclick = () => {
                const total = getFilteredTotal();
                mobileVisibleCount = total;
                renderGallery(); attachFlipHandlers();
            };
            btnDefault.onclick = () => {
                mobileVisibleCount = mobileInitial;
                renderGallery(); attachFlipHandlers();
                // after collapsing, perform a smooth scroll to the top of the page
                setTimeout(() => {
                    try { window.scrollTo({ top: 0, behavior: 'smooth' }); } catch (e) { window.scrollTo(0, 0); }
                }, 60);
            };
        }

        // Details modal: open/close and attach handlers for 'Leer más' buttons
        function openDetailsModal(idx) {
            const modal = document.getElementById('detailModal');
            const titleEl = document.getElementById('detailModalTitle');
            const bodyEl = document.getElementById('detailModalBody');
            const item = achievements[idx];
            if (!modal || !item) return;
            titleEl.textContent = item.title || '';
            bodyEl.innerHTML = (item.fullSummary || '');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeDetailsModal() {
            const modal = document.getElementById('detailModal');
            if (!modal) return;
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }

        function attachDetailHandlers() {
            document.querySelectorAll('.btn-open-details').forEach(btn => {
                // Only bind by index if a data-idx attribute is present (preserve direct bindings)
                if (btn.dataset && btn.dataset.idx) {
                    btn.onclick = (e) => { const idx = parseInt(btn.dataset.idx, 10); openDetailsModal(idx); };
                }
            });
            const modal = document.getElementById('detailModal');
            if (modal) {
                modal.addEventListener('click', (e) => { if (e.target === modal) closeDetailsModal(); });
                // attach close handler to footer button only (top X removed)
                modal.querySelectorAll('.modal-close-footer').forEach(b => { b.onclick = closeDetailsModal; });
                document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeDetailsModal(); });
            }
        }

        // Apply loaded data and render
        function applyData(payload) {
            const items = payload && payload.logros ? payload.logros : (Array.isArray(payload) ? payload : []);
            achievements = items.map(x => Object.assign({}, x));
            achievements.forEach((a, i) => {
                // Ensure canonical fields exist; derive short previews from fullSummary when needed
                if (!a.fullSummary) a.fullSummary = a.fullSummary || '';
                if (!a.frontSummary) a.frontSummary = (a.fullSummary && a.fullSummary.length) ? ((a.fullSummary.length > 180) ? a.fullSummary.slice(0, 177) + '...' : a.fullSummary) : '';
                if (!a.backSummary) a.backSummary = (a.fullSummary && a.fullSummary.length) ? ((a.fullSummary.length > 140) ? a.fullSummary.slice(0, 137) + '...' : a.fullSummary) : '';
                if (!a.category) a.category = (i % 3 === 0) ? 'Administración' : (i % 3 === 1) ? 'Infraestructura' : 'Servicios';
                if (!a.status) a.status = (i % 4 === 0) ? 'Completado' : (i % 4 === 1) ? 'En progreso' : 'Planificado';
                if (!a.progress) a.progress = (a.status === 'Completado') ? 100 : (a.status === 'En progreso') ? 52 : 12;
            });
            // Build palette from payload categories when provided so JSON is the single source of truth
            try {
                if (payload && Array.isArray(payload.categories)) {
                    _palette = {};
                    categoriesList = [];
                    payload.categories.forEach(c => {
                        const name = c.name || c.nombre;
                        if (!name) return;
                        const bg = c.color || c.bg || '#d4e6d0';
                        const fg = c.textColor || c.fg || '#233';
                        _palette[name] = [bg, fg];
                        categoriesList.push(name);
                    });
                }
            } catch (e) { /* ignore palette build errors */ }
            renderFilterOptions();
            renderGallery();
            attachFlipHandlers();
        }

        function renderFilterOptions() {
            const catSel = document.getElementById('filterCategory');
            const statSel = document.getElementById('filterStatus');
            if (!catSel || !statSel) return;
            // gather unique: include categories defined in data even if they have no items
            const cats = Array.from(new Set([...(categoriesList || []), ...achievements.map(a => a.category)])).sort();
            const stats = Array.from(new Set(achievements.map(a => a.status))).sort();
            // reset
            catSel.innerHTML = '<option value="">Todas</option>';
            statSel.innerHTML = '<option value="">Todos</option>';
            cats.forEach(c => {
                const o = document.createElement('option'); o.value = c; o.textContent = c; catSel.appendChild(o);
            });
            stats.forEach(s => {
                const o = document.createElement('option'); o.value = s; o.textContent = s; statSel.appendChild(o);
            });
            // attach events
            catSel.onchange = () => { currentCategory = catSel.value; renderGallery(); attachFlipHandlers(); };
            statSel.onchange = () => { currentStatus = statSel.value; renderGallery(); attachFlipHandlers(); };
            const clearBtn = document.getElementById('btn-clear');
            if (clearBtn) clearBtn.onclick = () => { currentCategory = ''; currentStatus = ''; catSel.value = ''; statSel.value = ''; renderGallery(); attachFlipHandlers(); };
        }

        /* CTA watchers removed - CTA now follows --progress-color */

        // Load JSON similarly to other pages: prefer network, fallback to embedded, support file:// previews
        (function loadLogros() {
            if (window && window.EMBEDDED_LOGROS) {
                applyData(window.EMBEDDED_LOGROS);
                return;
            }

            if (location.protocol === 'file:') {
                try {
                    if (!document.querySelector('script[src="includes/embedded-data.js"]')) {
                        const s = document.createElement('script');
                        s.src = 'includes/embedded-data.js';
                        s.async = true;
                        document.head.appendChild(s);
                    }
                } catch (e) { }

                const start = Date.now();
                const id = setInterval(() => {
                    if (window && window.EMBEDDED_LOGROS) {
                        clearInterval(id);
                        applyData(window.EMBEDDED_LOGROS);
                        return;
                    }
                    if (Date.now() - start > 1200) {
                        clearInterval(id);
                        const fallbackUrl = (typeof location !== 'undefined') ? new URL('logros.json', location.href).toString() : 'logros.json';
                        fetch(fallbackUrl, { cache: 'no-store' }).then(r => r.json()).then(applyData).catch(err => console.warn('Could not load logros.json nor embedded fallback', err));
                    }
                }, 100);

                return;
            }

            const dataUrl = (typeof location !== 'undefined') ? new URL('logros.json', location.href).toString() : 'logros.json';
            fetch(dataUrl, { cache: 'no-store' })
                .then(r => { if (!r.ok) throw new Error('no-data'); return r.json(); })
                .then(applyData)
                .catch(err => {
                    if (window && window.EMBEDDED_LOGROS) {
                        applyData(window.EMBEDDED_LOGROS);
                    } else {
                        console.warn('Failed to load logros.json and no embedded fallback available', err);
                    }
                });

        })();

        /* Palette testing helpers removed */
    </script>

    <!-- Footer fragment (injected) -->

    <div id="footerInclude"></div>



    <script src="includes/load-fragments.js"></script>

    <!-- Mobile sticky controls: moved here to ensure they are fixed to the viewport and
         not positioned relative to injected footer or other fragments. -->
    <div class="mobile-sticky-controls" aria-hidden="false">
        <button id="mobileShowDefault" class="m-btn secondary" title="Colapsar lista" aria-label="Colapsar lista">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <polyline points="6 15 12 9 18 15"></polyline>
            </svg>
        </button>
        <button id="mobileShowAll" class="m-btn secondary" title="Expandir lista" aria-label="Expandir lista">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        </button>
    </div>

    <!-- Detail modal (hidden) -->
    <div id="detailModal" class="detail-modal" role="dialog" aria-hidden="true">
        <div class="detail-dialog" role="document">
            <h3 id="detailModalTitle" class="modal-title"></h3>
            <div id="detailModalBody" class="modal-body"></div>
            <div class="modal-footer"><button class="modal-close-footer">Cerrar</button></div>
        </div>
    </div>
</body>

</html>