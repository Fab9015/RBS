<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Emocional con JSON</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f4f4;
      margin: 40px 20px;
      color: #333;
    }
    header {
      text-align: center;
      margin-bottom: 50px;
    }
    header h1 {
      font-size: 28px;
      margin-bottom: 10px;
    }
    .chart-box {
      background: white;
      padding: 20px;
      margin: 0 auto 40px auto;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      max-width: 680px;
    }
    .chart-box h2 {
      text-align: center;
      font-size: 18px;
      margin-bottom: 15px;
    }
    .emoji {
      text-align: center;
      font-size: 40px;
      margin-bottom: 10px;
    }
    .interpretacion {
      text-align: center;
      font-size: 15px;
      color: #555;
      margin-top: 10px;
      margin-bottom: 10px;
    }
    canvas {
      width: 100%;
      max-height: 180px;
      margin-bottom: 10px;
    }
    .velocimetro canvas {
      max-height: 260px;
    }
    .conteo {
      font-size: 14px;
      margin-top: 10px;
      padding: 10px;
      background: #f9f9f9;
      border-radius: 8px;
    }
    .conteo span {
      display: inline-block;
      padding: 5px 8px;
      margin: 3px;
      border-radius: 5px;
      font-weight: bold;
      color: white;
    }
  </style>
</head>
<body>

<header>
  <h1>Dashboard Emocional Comunitario</h1>
</header>

<div id="contenedorGraficas"></div>

<script>
  const preguntas = [
    { clave: "p1", texto: "1. Â¿QuÃ© tan deacuerdo estÃ¡s con la administraciÃ³n de Agendum/Parametro?" },
    { clave: "p2", texto: "2. Â¿QuÃ© tan deacuerdo estÃ¡s en cambiar la administraciÃ³n actual?" },
    { clave: "p3", texto: "3. Â¿QuÃ© tan deacuerdo estÃ¡s con aumentar la cuota si es necesario?" },
    { clave: "p4", texto: "4. Â¿SabÃ­as que si la cuota no es adecuada, la cantidad y/o calidad de los servicios puede verse afectada?", binaria: true },
    { clave: "p5", texto: "5. Â¿QuÃ© tan disponible te consideras para participar en actividades del condominio?" }
  ];

  const expresiones = ["ðŸ˜ ", "ðŸ˜’", "ðŸ˜•", "ðŸ˜", "ðŸ™‚", "ðŸ˜„"];
  const interpretaciones = [
    "Desagrado total", "Molestia leve", "InsatisfacciÃ³n", "Neutral", "AprobaciÃ³n", "Agrado total"
  ];
  const colores = ["#d73027", "#fc8d59", "#fdae61", "#fee08b", "#a6d96a", "#1a9850"];

  fetch('datos.json')
    .then(response => response.json())
    .then(datos => {
      const contenedor = document.getElementById("contenedorGraficas");

      preguntas.forEach(pregunta => {
        const div = document.createElement("div");
        div.className = "chart-box";
        const canvasId = `grafico_${pregunta.clave}`;

        let valor, conteo = {}, total = datos.length;

        if (pregunta.binaria) {
          const si = datos.filter(d => d.p4 === "SÃ­").length;
          valor = Math.round((si / total) * 100);
        } else {
          valor = Math.round(datos.reduce((sum, d) => sum + d[pregunta.clave], 0) / total);
          for (let i = 0; i <= 5; i++) {
            conteo[i] = datos.filter(d => d[pregunta.clave] === i).length;
          }
        }

        const emoji = pregunta.binaria
          ? (valor < 40 ? "ðŸ˜ " : valor < 70 ? "ðŸ˜" : "ðŸ˜„")
          : expresiones[valor];

        const textoInterpretativo = pregunta.binaria
          ? `AprobaciÃ³n del ${valor}% â€” ${valor < 40 ? "Predomina el desagrado" : valor < 70 ? "Resultado neutral" : "Predomina el agrado"}`
          : `Promedio emocional: ${valor} â€” ${interpretaciones[valor]}`;

        div.innerHTML = `
          <h2>${pregunta.texto}</h2>
          <div class="emoji">${emoji}</div>
          <canvas id="${canvasId}"></canvas>
          <div class="interpretacion">${textoInterpretativo}</div>
        `;

        if (!pregunta.binaria) {
          const resumen = document.createElement("div");
          resumen.className = "conteo";
          resumen.innerHTML = `<strong>Total votos:</strong> ${total}<br><strong>Conteo por nivel:</strong><br>`;
          for (let i = 0; i <= 5; i++) {
            resumen.innerHTML += `<span style="background:${colores[i]}">${i}: ${conteo[i]}</span> `;
          }
          div.appendChild(resumen);
        }

        contenedor.appendChild(div);

        const canvas = document.getElementById(canvasId);
        const ctx = canvas.getContext("2d");
        const grad = ctx.createLinearGradient(0, 0, canvas.width, 0);
        grad.addColorStop(0.0, "#d73027");
        grad.addColorStop(0.5, "#f1c40f");
        grad.addColorStop(1.0, "#2ecc71");

        if (pregunta.binaria) {
          new Chart(ctx, {
            type: "doughnut",
            data: {
              labels: ["SÃ­", "No"],
              datasets: [{
                data: [valor, 100 - valor],
                backgroundColor: [grad, "#eee"],
                rotation: -90,
                circumference: 180
              }]
            },
            options: {
              cutout: "70%",
              plugins: {
                legend: { display: false },
                tooltip: {
                  callbacks: {
                    label: ctx => `${ctx.label}: ${ctx.raw}%`
                  }
                }
              }
            }
          });
        } else {
          new Chart(ctx, {
            type: "bar",
            data: {
              labels: [pregunta.clave.toUpperCase()],
              datasets: [{
                label: "Nivel emocional",
                data: [valor],
                backgroundColor: grad
              }]
            },
            options: {
              indexAxis: 'y',
              scales: {
                x: {
                  min: 0,
                  max: 5,
                  ticks: {
                    callback: val => expresiones[val] || val
                  }
                },
                y: { ticks: { display: false } }
              },
              plugins: {
                legend: { display: false },
                tooltip: {
                  callbacks: {
                    label: ctx => `Nivel promedio: ${ctx.raw} (${expresiones[ctx.raw] || ''})`
                  }
                }
              }
            }
          });
        }
      });
    });
</script>
</body>
</html>
