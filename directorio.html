<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Directorio de Contactos</title>
  <style>
    :root {
      --color-bg: #fdfaf5;
      --color-title: #5c4033;
      --color-accent: #25D366; /* color oficial WhatsApp */
      --color-white: #fefefe;
      --color-text: #5c4033;
      --color-border: #e6e2dc;
    }
    body {
      font-family: 'Lato', sans-serif;
      background: var(--color-bg);
      margin: 0;
      padding: 0;
      color: var(--color-text);
      overflow-x: hidden;
    }
    h1,h2,h3 { font-family: 'Montserrat', sans-serif; }
    h2,h3,h4 { color: var(--color-title); }
    header {
      text-align: center;
      padding: 2em 1em;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      padding: 1em;
    }

    /* Contact card */
    .contact-card {
      display: flex;
      align-items: center;
      background: var(--color-bg);
      border: 1px solid var(--color-border);
      border-radius: 8px;
      padding: 1em;
      margin-bottom: 1em;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      max-width: 100%;
    }
    .contact-card img {
      width: 100px;
      height: 100px;
      object-fit: contain;
      margin-right: 1em;
    }
    .contact-info h3 {
      margin: 0;
      color: var(--color-title);
    }

    .whatsapp-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: var(--color-accent);
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      text-decoration: none;
      font-size: 0.95em;
      margin-top: 6px;
      margin-bottom: 6px;
    }
    .whatsapp-btn svg {
      width: 18px;
      height: 18px;
      fill: white;
    }

    /* Carrusel */
    #carousel-container {
      position: relative;
      overflow: hidden;
      width: 100%;
    }
    #relevantes {
      display: flex;
      transition: transform 0.3s ease-in-out;
      width: 100%;
    }
    #relevantes .contact-card {
      flex: 0 0 80%; /* más angosta */
      margin: 0 auto;
    }
    .carousel-indicators {
      text-align: center;
      margin-top: 0.5em;
    }
    .carousel-indicators span {
      display: inline-block;
      width: 10px;
      height: 10px;
      margin: 0 4px;
      background: var(--color-border);
      border-radius: 50%;
      cursor: pointer;
    }
    .carousel-indicators span.active {
      background: var(--color-accent);
    }

    /* Tabs */
    .tabs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.8em;
      margin: 1em 0;
    }
    .tabs button {
      background: var(--color-accent);
      color: var(--color-white);
      border: none;
      padding: 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1.1em;
    }

    /* Lista trabajadores */
    #lista {
      max-width: 100%;
      margin: 0 auto;
    }
    #lista .contact-card {
      flex-direction: row;
    }

    /* Paginación */
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 1em 0;
    }
    .pagination button {
      background: var(--color-accent);
      color: var(--color-white);
      border: none;
      font-size: 0.9em;
      padding: 6px 10px;
      margin: 0 4px;
      border-radius: 4px;
      cursor: pointer;
    }

    /* Responsive móvil */
    @media (max-width: 768px) {
      .contact-line {
        flex-direction: column;
        align-items: flex-start;
        margin-bottom: 0.5em;
      }
      .whatsapp-btn {
        margin-left: 0;
        margin-top: 6px;
        margin-bottom: 6px;
        font-size: 1em;
        padding: 6px 12px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Directorio de Contactos del Condominio</h1>
    <p>Encuentra teléfonos y correos de trabajadores recomendados y contactos importantes.</p>
  </header>

  <div class="container">
    <h2>Contactos importantes</h2>
    <div id="carousel-container">
      <div id="relevantes"></div>
      <div class="carousel-indicators" id="carousel-indicators"></div>
    </div>

    <div class="tabs" id="tabs"></div>

    <div class="filter">
      <label for="categoria">Selecciona categoría: </label>
      <select id="categoria">
        <option value="todos">Todos</option>
      </select>
    </div>

    <h2 style="margin-top:1.5em;">Resultados</h2>
    <div id="lista"></div>

    <div class="pagination" id="paginacion"></div>

    <div class="filter" style="text-align:left;">
      <label for="porPagina">Elementos por página: </label>
      <select id="porPagina">
        <option value="5" selected>5</option>
        <option value="10">10</option>
        <option value="15">15</option>
      </select>
    </div>
  </div>
    <script>
    let datos = {};
    let paginaActual = 1;
    let porPagina = 5; 
    let currentSlide = 0; 
    let startX = 0;
    let isDragging = false;

    fetch('directorio.json')
      .then(r => r.json())
      .then(json => {
        datos = json;
        renderRelevantes();
        renderIndicators();
        renderTabs();
        renderCategorias();
        renderLista();
        renderPaginacion();
        initCarouselTouch();
      });

    /* Carrusel de contactos importantes */
    function renderRelevantes() {
      const cont = document.getElementById('relevantes');
      cont.innerHTML = "";
      datos.relevantes.forEach((c, i) => {
        const icono = i === 0 ? "img/admin.png" : i === 1 ? "img/vigilancia.png" : "img/trabajador.png";
        const whatsapp = `https://wa.me/52${c.telefono}?text=Hola,%20me%20comunico%20desde%20el%20directorio%20del%20condominio`;
        const correo = c.correo ? `<div class="contact-line"><strong>Email:</strong> <a href="mailto:${c.correo}">${c.correo}</a></div>` : "";
        cont.innerHTML += `
          <div class="contact-card">
            <img src="${icono}" alt="${c.nombre}">
            <div class="contact-info">
              <h3>${c.nombre}</h3>
              <div class="contact-line">
                <strong>Tel:</strong> <a href="tel:${c.telefono}">${c.telefono}</a>
              </div>
              <a class="whatsapp-btn" href="${whatsapp}" target="_blank">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                  <path d="M380.9 97.1C339-2.9 224.8-32 132.4 19.6 39.9 71.2-9.6 178.5 16.1 281.4l-15.6 92.3c-2.2 13.1 9.2 24.5 22.3 22.3l92.3-15.6c102.9 25.7 210.2-23.8 261.8-116.3 51.6-92.4 22.5-206.6-96-266.9zM224 400c-97.2 0-176-78.8-176-176S126.8 48 224 48s176 78.8 176 176-78.8 176-176 176z"/>
                </svg>
                WhatsApp
              </a>
              ${correo}
            </div>
          </div>`;
      });
      updateCarousel();
    }

    function renderIndicators() {
      const ind = document.getElementById('carousel-indicators');
      ind.innerHTML = "";
      datos.relevantes.forEach((_, i) => {
        ind.innerHTML += `<span onclick="goToSlide(${i})" id="indicator-${i}"></span>`;
      });
      updateIndicators();
    }

    function updateCarousel() {
      const cont = document.getElementById('relevantes');
      cont.style.transform = `translateX(-${currentSlide * 100}%)`;
      updateIndicators();
    }

    function updateIndicators() {
      datos.relevantes.forEach((_, i) => {
        const el = document.getElementById(`indicator-${i}`);
        if(el) el.classList.toggle("active", i === currentSlide);
      });
    }

    function goToSlide(index) {
      if(index < 0 || index >= datos.relevantes.length) return;
      currentSlide = index;
      updateCarousel();
    }

    function initCarouselTouch() {
      const carousel = document.getElementById('relevantes');
      carousel.addEventListener('touchstart', e => {
        startX = e.touches[0].clientX;
        isDragging = true;
      });
      carousel.addEventListener('touchmove', e => {
        if(!isDragging) return;
        const diff = e.touches[0].clientX - startX;
        if(diff > 50) { 
          goToSlide(currentSlide - 1);
          isDragging = false;
        } else if(diff < -50) { 
          goToSlide(currentSlide + 1);
          isDragging = false;
        }
      });
      carousel.addEventListener('touchend', () => {
        isDragging = false;
      });
    }

    /* Tabs */
    function renderTabs() {
      const cont = document.getElementById('tabs');
      cont.innerHTML = "";
      datos.busquedasRelevantes.forEach(b => {
        if(b.activo){
          cont.innerHTML += `<button onclick="filtrar('${b.categoria}', this)">${b.categoria}</button>`;
        }
      });
    }

    function renderCategorias() {
      const sel = document.getElementById('categoria');
      datos.categorias.forEach(cat => {
        const opt = document.createElement("option");
        opt.value = cat;
        opt.textContent = cat;
        sel.appendChild(opt);
      });
    }
          function filtrar(cat, btn) {
      document.getElementById('categoria').value = cat;
      paginaActual = 1;
      renderLista();
      renderPaginacion();
      document.querySelectorAll('.tabs button').forEach(b => b.classList.remove('active-tab'));
      btn.classList.add('active-tab');
    }

    /* Lista de trabajadores */
    function renderLista() {
      const lista = document.getElementById('lista');
      lista.innerHTML = "";
      const categoria = document.getElementById('categoria').value;
      let filtrados = datos.trabajadores;
      if(categoria !== "todos"){
        filtrados = filtrados.filter(t => t.categoria === categoria);
      }
      const inicio = (paginaActual - 1) * porPagina;
      const fin = inicio + porPagina;
      const pagina = filtrados.slice(inicio, fin);

      pagina.forEach(t => {
        const whatsappLink = `https://wa.me/52${t.telefono}?text=Hola,%20me%20comunico%20desde%20el%20directorio%20del%20condominio`;
        const correoLink = t.correo ? `<div class="contact-line"><strong>Email:</strong> <a href="mailto:${t.correo}">${t.correo}</a></div>` : "";
        lista.innerHTML += `
          <div class="contact-card">
            <img src="img/trabajador.png" alt="${t.categoria}">
            <div class="contact-info">
              <h3>${t.nombre}</h3>
              <div class="contact-line">
                <strong>Tel:</strong> <a href="tel:${t.telefono}">${t.telefono}</a>
              </div>
              <a class="whatsapp-btn" href="${whatsappLink}" target="_blank">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                  <path d="M380.9 97.1C339-2.9 224.8-32 132.4 19.6 39.9 71.2-9.6 178.5 16.1 281.4l-15.6 92.3c-2.2 13.1 9.2 24.5 22.3 22.3l92.3-15.6c102.9 25.7 210.2-23.8 261.8-116.3 51.6-92.4 22.5-206.6-96-266.9zM224 400c-97.2 0-176-78.8-176-176S126.8 48 224 48s176 78.8 176 176-78.8 176-176 176z"/>
                </svg>
                WhatsApp
              </a>
              ${correoLink}
              <div class="contact-line-inline">
                <strong>Categoría:</strong> ${t.categoria}
              </div>
            </div>
          </div>`;
      });
    }

    /* Paginación */
    function renderPaginacion() {
      const cont = document.getElementById('paginacion');
      cont.innerHTML = "";
      const categoria = document.getElementById('categoria').value;
      let filtrados = datos.trabajadores;
      if(categoria !== "todos"){
        filtrados = filtrados.filter(t => t.categoria === categoria);
      }
      const totalPaginas = Math.ceil(filtrados.length / porPagina);
      if(totalPaginas <= 1) return;

      cont.innerHTML += `<button onclick="cambiarPagina(${paginaActual-1})" ${paginaActual===1?"disabled":""}>&laquo;</button>`;
      for(let i=1; i<=totalPaginas; i++){
        cont.innerHTML += `<button onclick="cambiarPagina(${i})" ${i===paginaActual?"style='background:var(--color-title);color:white;'":""}>${i}</button>`;
      }
      cont.innerHTML += `<button onclick="cambiarPagina(${paginaActual+1})" ${paginaActual===totalPaginas?"disabled":""}>&raquo;</button>`;
    }

    function cambiarPagina(num) {
      const categoria = document.getElementById('categoria').value;
      let filtrados = datos.trabajadores;
      if(categoria !== "todos"){
        filtrados = filtrados.filter(t => t.categoria === categoria);
      }
      const totalPaginas = Math.ceil(filtrados.length / porPagina);
      if(num < 1 || num > totalPaginas) return;
      paginaActual = num;
      renderLista();
      renderPaginacion();
    }

    document.getElementById('porPagina').addEventListener('change', e => {
      porPagina = parseInt(e.target.value);
      paginaActual = 1;
      renderLista();
      renderPaginacion();
    });
  </script>
</body>
</html>
